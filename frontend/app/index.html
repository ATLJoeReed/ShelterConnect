<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>ShelterConnect</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

    <link rel="stylesheet" href="css/style.css">
    <link href='https://fonts.googleapis.com/css?family=Nunito:400,300,700|Open+Sans:400,700,400italic' rel='stylesheet' type='text/css'>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>


  <!-- Static navbar -->
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a id="logo" class="navbar-brand navbar-brand-centered" href="#home"><span class="glyphicon glyphicon-home" aria-hidden="true"></span>ShelterConnect</a>
      </div>
      <div id="navbar" class="navbar-collapse collapse">
        <ul class="nav navbar-nav navbar-right">
          <li id="homeTab" class="active"><a href="#home">Home <span class="sr-only">(current)</span></a></li>
          <li><a href="#about">About</a></li>
        </ul>
      </div><!--/.nav-collapse -->
    </div><!--/.container-fluid -->
  </nav>

<div id="home">

    <div id="app"></div>

</div> <!-- main -->

<div id="about">

  <h1>test</h1>
</div>

<div class="container">

  <!-- Modal -->
  <div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">

      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">How many beds to reserve?</h4>
        </div>
        <div class="modal-body">
          <p>Some text in the modal.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>

    </div>
  </div>

</div>

<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react-dom.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBM4USDQ9HqqDLkhrkBhPuvabZW-a92uiY" type="text/javascript"></script>
<script src="./js/fetch.js"></script>
<script type="text/babel">
  class App extends React.Component {
    constructor(props) {
      super(props);
      this.state = {
        data: [
          {
            name: 'Safehouse Outreach',
            phone: '404-523-2221',
            beds_available: 3,
            lat: 33.757960,
            lng: -84.383492,
            address: '89 Ellis St NE, Atlanta, GA 30303',
            dist: 3
          },
          {
            name: 'Atlanta\'s Children Shelter',
            phone: '404-892-3713',
            bedsAvailable: 0,
            lat: 33.770828,
            lng: -84.385625,
            address: '607 Peachtree St NE, Atlanta, GA 30308',
            dist: 2
          },
          {
            name: 'The Shepards Inn',
            phone: '404-367-2493',
            bedsAvailable: 1,
            lat: 33.764855,
            lng: -84.392205,
            address: '156 Mills St NW, Atlanta, GA 30313',
            dist: 1
          },
          {
            name: 'The Shepards Inn',
            phone: '404-367-2493',
            bedsAvailable: 1,
            lat: 33.764855,
            lng: -84.392205,
            address: '156 Mills St NW, Atlanta, GA 30313',
            dist: 6
          }
        ],
      };
    }
    componentDidMount() {
      window.navigator.geolocation.getCurrentPosition((pos) => {
        const loc = {
          lat: pos.coords.latitude,
          lng: pos.coords.longitude,
        };

        let data;
        $.ajax({
          url: `https://infinite-brook-58503.herokuapp.com/api/shelters.php?lat=${loc.lat}&long=${loc.lng}`,
          crossDomain: true,
          dataType: 'json',
          xhrFields: {
            widthCredentials: true,
          },
          success: function(data) {
            this.setState({ data });
            const map = new google.maps.Map(document.getElementById('map'), {
              center: loc,
              zoom: 13,
            });

            const infoWindow = new google.maps.InfoWindow({
              content: `
                <div>
                  <p>there are 6 beds available.</p>
                  <button>Reserve</button>
                </div>
              `,
            });
            const marker = new google.maps.Marker({
              position: loc,
              map,
              title: 'Your Location',
            });
            marker.addListener('click', () => {
              infoWindow.open(map, marker);
            });

            this.state.data.forEach(shelter => {
              const mark = new google.maps.Marker({
                position: { lat: Number(shelter.lat), lng: Number(shelter.long) },
                map,
                title: shelter.name,
              });
            });
          }.bind(this)
        });
      });
    }

    render() {
      return (
        <div>
          <div id="map"></div>
          <div className="container">
          <div className="row">
            <div className="col-sm-12">
              <h1 id="greeting" className="text-center">Find the closest open beds</h1>
            </div>
          </div>
          <List data={this.state.data} />
        </div>
        </div>
      );
    }
  }
  class List extends React.Component {
    constructor(props) {
      super(props);
    }

    render() {
      const nodes = this.props.data.map(shelter => <Shelter data={shelter} />);
      return <div className="shelter-list"> {nodes} </div>;
    }
  }
  class Shelter extends React.Component {
  constructor(props) {
    super(props);
  }

  componentDidMount() {
    $(this.refs.shelter).on('click', function(e) {
  var $this = $(this);

  if ($this.hasClass('shelterActive')) {
    $('.shelter').removeClass('shelterActive');
    return;
  }
  $('.shelter').removeClass('shelterActive');
  if (!$this.hasClass('shelterActive')) {
      $this.addClass('shelterActive');
  }
  e.preventDefault();
});
  }

  render() {
    return (
  <div ref="shelter" className="shelter row">
        <div className="bedDisplay">
          <svg className="bed" version="1.1" id="Layer_1"  x="0px" y="0px"
             viewBox="0 0 89.9 57.8">
          <g>
            <path d="M19.3,22.8c4.5,0,8.2-3.7,8.2-8.2c0-4.5-3.7-8.2-8.2-8.2c-4.5,0-8.2,3.7-8.2,8.2C11.1,19.1,14.8,22.8,19.3,22.8z"/>
            <path d="M15,31.9h17.2c2,0,3.6-1.4,4-3.3c0.1-0.3,0.1-0.6,0.1-0.9V16.2c0-2.3-1.8-4.1-4.1-4.1c-2.3,0-4.1,1.8-4.1,4.1v7.5H15c-2.3,0-4.1,1.8-4.1,4.1C10.9,30.1,12.8,31.9,15,31.9z"/>
            <path d="M79.2,31.2c0-10.3-8.4-19.2-18.7-19.2H38v19.8h41.2C79.2,31.7,79.2,31.5,79.2,31.2z"/>
            <path d="M85.2,11.7c-2.6,0-4.7,2.1-4.7,4.7v17.9H9.4V4.7C9.4,2.1,7.3,0,4.7,0C2.1,0,0,2.1,0,4.7v53.1h9.4v-13h71.1v13h9.4V16.5C89.9,13.9,87.8,11.7,85.2,11.7z"/>
          </g>
          </svg>
          <p className="text-center">{this.props.data.beds_available}</p>
        </div>
        <div className="bedInfo">
          <h2>{this.props.data.name}</h2>
          <p>{`${Number(this.props.data.dist).toFixed(2)} miles away`}</p>
          <p><a href={`tel:${this.props.data.phone_number_1}`}>{this.props.data.phone_number_1}</a></p>          <p>{this.props.data.address1}</p>
          <button className="reserve">Reserve</button>
          <button>Directions</button>
        </div>
    </div>
    );
  }
}
  ReactDOM.render(<App />, document.getElementById('app'));
</script>
<script>

$('.navbar-nav li, .navbar-brand ').click(function(e) {
  var activeTag = e.target.hash;
  $('#home').css('display','none');
  $('#about').css('display','none');
  $('#faq').css('display','none');
  $('#sponsors').css('display','none');
  $(activeTag).css('display','block');
    $('.navbar li.active').removeClass('active');
    if (this.id == 'logo'){
      var $this = $('#homeTab');
    } else {
      var $this = $(this);
    }
    if (!$this.hasClass('active')) {
        $this.addClass('active');
    }
    e.preventDefault();
});

$('button, a').click(function(e){
  // e.stopPropagation();
  console.log('click reserve');
});

</script>
</body>
</html>
